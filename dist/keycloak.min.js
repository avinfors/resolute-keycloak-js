!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("keycloak",t):(e="undefined"!=typeof globalThis?globalThis:e||self).Keycloak=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var t={exports:{}};!function(t){t.exports=function(){function t(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function n(e){return"function"==typeof e}function r(e){V=e}function o(e){B=e}function i(){return function(){return process.nextTick(l)}}function s(){return void 0!==D?function(){D(l)}:u()}function a(){var e=0,t=new Y(l),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function c(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}function u(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<q;e+=2)(0,$[e])($[e+1]),$[e]=void 0,$[e+1]=void 0;q=0}function d(){try{var e=Function("return this")().require("vertx");return D=e.runOnLoop||e.runOnContext,s()}catch(e){return u()}}function f(e,t){var n=this,r=new this.constructor(h);void 0===r[X]&&L(r);var o=n._state;if(o){var i=arguments[o-1];B((function(){return T(o,r,i,n._result)}))}else C(n,r,e,t);return r}function p(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(h);return y(n,e),n}function h(){}function g(){return new TypeError("You cannot resolve a promise with itself")}function m(){return new TypeError("A promises callback cannot return that same promise.")}function v(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function w(e,t,n){B((function(e){var r=!1,o=v(n,t,(function(n){r||(r=!0,t!==n?y(e,n):S(e,n))}),(function(t){r||(r=!0,U(e,t))}),"Settle: "+(e._label||" unknown promise"));!r&&o&&(r=!0,U(e,o))}),e)}function k(e,t){t._state===Z?S(e,t._result):t._state===ee?U(e,t._result):C(t,void 0,(function(t){return y(e,t)}),(function(t){return U(e,t)}))}function b(e,t,r){t.constructor===e.constructor&&r===f&&t.constructor.resolve===p?k(e,t):void 0===r?S(e,t):n(r)?w(e,t,r):S(e,t)}function y(e,n){if(e===n)U(e,g());else if(t(n)){var r=void 0;try{r=n.then}catch(t){return void U(e,t)}b(e,n,r)}else S(e,n)}function _(e){e._onerror&&e._onerror(e._result),A(e)}function S(e,t){e._state===Q&&(e._result=t,e._state=Z,0!==e._subscribers.length&&B(A,e))}function U(e,t){e._state===Q&&(e._state=ee,e._result=t,B(_,e))}function C(e,t,n,r){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+Z]=n,o[i+ee]=r,0===i&&e._state&&B(A,e)}function A(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,o=void 0,i=e._result,s=0;s<t.length;s+=3)r=t[s],o=t[s+n],r?T(n,r,o,i):o(i);e._subscribers.length=0}}function T(e,t,r,o){var i=n(r),s=void 0,a=void 0,c=!0;if(i){try{s=r(o)}catch(e){c=!1,a=e}if(t===s)return void U(t,m())}else s=o;t._state!==Q||(i&&c?y(t,s):!1===c?U(t,a):e===Z?S(t,s):e===ee&&U(t,s))}function E(e,t){try{t((function(t){y(e,t)}),(function(t){U(e,t)}))}catch(t){U(e,t)}}function I(){return te++}function L(e){e[X]=te++,e._state=void 0,e._result=void 0,e._subscribers=[]}function O(){return new Error("Array Methods must be provided an Array")}function R(e){return new ne(this,e).promise}function x(e){var t=this;return new t(K(e)?function(n,r){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function M(e){var t=new this(h);return U(t,e),t}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function j(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(){var t=void 0;if(void 0!==e)t=e;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;if(n){var r=null;try{r=Object.prototype.toString.call(n.resolve())}catch(e){}if("[object Promise]"===r&&!n.cast)return}t.Promise=re}var H=void 0;H=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var K=H,q=0,D=void 0,V=void 0,B=function(e,t){$[q]=e,$[q+1]=t,2===(q+=2)&&(V?V(l):W())},F="undefined"!=typeof window?window:void 0,J=F||{},Y=J.MutationObserver||J.WebKitMutationObserver,z="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),G="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$=new Array(1e3),W=void 0;W=z?i():Y?a():G?c():void 0===F?d():u();var X=Math.random().toString(36).substring(2),Q=void 0,Z=1,ee=2,te=0,ne=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(h),this.promise[X]||L(this.promise),K(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&S(this.promise,this._result))):U(this.promise,O())}return e.prototype._enumerate=function(e){for(var t=0;this._state===Q&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===p){var o=void 0,i=void 0,s=!1;try{o=e.then}catch(e){s=!0,i=e}if(o===f&&e._state!==Q)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(n===re){var a=new n(h);s?U(a,i):b(a,e,o),this._willSettleAt(a,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(r(e),t)},e.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===Q&&(this._remaining--,e===ee?U(r,n):this._result[t]=n),0===this._remaining&&S(r,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,(function(e){return n._settledAt(Z,t,e)}),(function(e){return n._settledAt(ee,t,e)}))},e}(),re=function(){function e(t){this[X]=I(),this._result=this._state=void 0,this._subscribers=[],h!==t&&("function"!=typeof t&&P(),this instanceof e?E(this,t):j())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,r=t.constructor;return n(e)?t.then((function(t){return r.resolve(e()).then((function(){return t}))}),(function(t){return r.resolve(e()).then((function(){throw t}))})):t.then(e,e)},e}();return re.prototype.then=f,re.all=R,re.race=x,re.resolve=p,re.reject=M,re._setScheduler=r,re._setAsap=o,re._asap=B,re.polyfill=N,re.Promise=re,re}()}(t);var n=t.exports;function r(e,...t){if(!((n=e)instanceof Uint8Array||null!=n&&"object"==typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");var n;if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function o(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const i=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),s=(e,t)=>e<<32-t|e>>>t;function a(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),r(e),e}new Uint8Array(new Uint32Array([287454020]).buffer)[0];class c{clone(){return this._cloneInto()}}function u(e){const t=t=>e().update(a(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}const l=(e,t,n)=>e&t^e&n^t&n;class d extends c{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=i(this.buffer)}update(e){o(this);const{view:t,buffer:n,blockLen:r}=this,s=(e=a(e)).length;for(let o=0;o<s;){const a=Math.min(r-this.pos,s-o);if(a!==r)n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=i(e);for(;r<=s-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){o(this),function(e,t){r(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:a}=this;let{pos:c}=this;t[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>s-c&&(this.process(n,0),c=0);for(let e=c;e<s;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),c=r?4:0,u=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+u,a,r)}(n,s-8,BigInt(8*this.length),a),this.process(n,0);const u=i(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=l/4,f=this.get();if(d>f.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<d;e++)u.setUint32(4*e,f[e],a)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}}const f=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),p=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),h=new Uint32Array(64);class g extends d{constructor(){super(64,32,8,!1),this.A=0|p[0],this.B=0|p[1],this.C=0|p[2],this.D=0|p[3],this.E=0|p[4],this.F=0|p[5],this.G=0|p[6],this.H=0|p[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:a}=this;return[e,t,n,r,o,i,s,a]}set(e,t,n,r,o,i,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)h[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=h[e-15],n=h[e-2],r=s(t,7)^s(t,18)^t>>>3,o=s(n,17)^s(n,19)^n>>>10;h[e]=o+h[e-7]+r+h[e-16]|0}let{A:n,B:r,C:o,D:i,E:a,F:c,G:u,H:d}=this;for(let e=0;e<64;e++){const t=d+(s(a,6)^s(a,11)^s(a,25))+((p=a)&c^~p&u)+f[e]+h[e]|0,g=(s(n,2)^s(n,13)^s(n,22))+l(n,r,o)|0;d=u,u=c,c=a,a=i+t|0,i=o,o=r,r=n,n=t+g|0}var p;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(n,r,o,i,a,c,u,d)}roundClean(){h.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const m=u((()=>new g));class v extends Error{}function w(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return atob(t)}}function k(e,t){if("string"!=typeof e)throw new v("Invalid token specified: must be a string");t||(t={});const n=!0===t.header?0:1,r=e.split(".")[n];if("string"!=typeof r)throw new v(`Invalid token specified: missing part #${n+1}`);let o;try{o=w(r)}catch(e){throw new v(`Invalid token specified: invalid base64 for part #${n+1} (${e.message})`)}try{return JSON.parse(o)}catch(e){throw new v(`Invalid token specified: invalid json for part #${n+1} (${e.message})`)}}if(v.prototype.name="InvalidTokenError",void 0===n.Promise)throw Error("Keycloak requires an environment that supports Promises. Make sure that you include the appropriate polyfill.");return function e(t){if(!(this instanceof e))throw new Error("The 'Keycloak' constructor must be invoked with 'new'.");for(var r,o,i=this,s=[],a={enable:!0,callbackList:[],interval:5},c=document.getElementsByTagName("script"),u=0;u<c.length;u++)-1===c[u].src.indexOf("keycloak.js")&&-1===c[u].src.indexOf("keycloak.min.js")||-1===c[u].src.indexOf("version=")||(i.iframeVersion=c[u].src.substring(c[u].src.indexOf("version=")+8).split("&")[0]);var l=!0,d=L(console.info),f=L(console.warn);function p(e,t){for(var n=function(e){var t=null,n=window.crypto||window.msCrypto;if(n&&n.getRandomValues&&window.Uint8Array)return t=new Uint8Array(e),n.getRandomValues(t),t;t=new Array(e);for(var r=0;r<t.length;r++)t[r]=Math.floor(256*Math.random());return t}(e),r=new Array(e),o=0;o<e;o++)r[o]=t.charCodeAt(n[o]%t.length);return String.fromCharCode.apply(null,r)}function h(e,t){if("S256"!==e)throw new TypeError(`Invalid value for 'pkceMethod', expected 'S256' but got '${e}'.`);const n=function(e){const t=String.fromCodePoint(...e);return btoa(t)}(m(t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"");return n}function g(){return void 0!==i.authServerUrl?"/"==i.authServerUrl.charAt(i.authServerUrl.length-1)?i.authServerUrl+"realms/"+encodeURIComponent(i.realm):i.authServerUrl+"/realms/"+encodeURIComponent(i.realm):void 0}function v(e){return 0==e.status&&e.responseText&&e.responseURL.startsWith("file:")}function w(e,t,n,r){if(i.tokenTimeoutHandle&&(clearTimeout(i.tokenTimeoutHandle),i.tokenTimeoutHandle=null),t?(i.refreshToken=t,i.refreshTokenParsed=k(t)):(delete i.refreshToken,delete i.refreshTokenParsed),n?(i.idToken=n,i.idTokenParsed=k(n)):(delete i.idToken,delete i.idTokenParsed),e){if(i.token=e,i.tokenParsed=k(e),i.sessionId=i.tokenParsed.sid,i.authenticated=!0,i.subject=i.tokenParsed.sub,i.realmAccess=i.tokenParsed.realm_access,i.resourceAccess=i.tokenParsed.resource_access,r&&(i.timeSkew=Math.floor(r/1e3)-i.tokenParsed.iat),null!=i.timeSkew&&(d("[KEYCLOAK] Estimated time difference between browser and server is "+i.timeSkew+" seconds"),i.onTokenExpired)){var o=1e3*(i.tokenParsed.exp-(new Date).getTime()/1e3+i.timeSkew);d("[KEYCLOAK] Token expires in "+Math.round(o/1e3)+" s"),o<=0?i.onTokenExpired():i.tokenTimeoutHandle=setTimeout(i.onTokenExpired,o)}}else delete i.token,delete i.tokenParsed,delete i.subject,delete i.realmAccess,delete i.resourceAccess,i.authenticated=!1}function b(){var e="0123456789abcdef",t=p(36,e).split("");return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}function y(e,t){for(var n=e.split("&"),r={paramsString:"",oauthParams:{}},o=0;o<n.length;o++){var i=n[o].indexOf("="),s=n[o].slice(0,i);-1!==t.indexOf(s)?r.oauthParams[s]=n[o].slice(i+1):(""!==r.paramsString&&(r.paramsString+="&"),r.paramsString+=n[o])}return r}function _(){var e={setSuccess:function(t){e.resolve(t)},setError:function(t){e.reject(t)}};return e.promise=new n.Promise((function(t,n){e.resolve=t,e.reject=n})),e}function S(){var e=_();if(!a.enable)return e.setSuccess(),e.promise;if(a.iframe)return e.setSuccess(),e.promise;var t=document.createElement("iframe");a.iframe=t,t.onload=function(){var t=i.endpoints.authorize();"/"===t.charAt(0)?a.iframeOrigin=window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""):a.iframeOrigin=t.substring(0,t.indexOf("/",8)),e.setSuccess()};var n=i.endpoints.checkSessionIframe();t.setAttribute("src",n),t.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),t.setAttribute("title","keycloak-session-iframe"),t.style.display="none",document.body.appendChild(t);return window.addEventListener("message",(function(e){if(e.origin===a.iframeOrigin&&a.iframe.contentWindow===e.source&&("unchanged"==e.data||"changed"==e.data||"error"==e.data)){"unchanged"!=e.data&&i.clearToken();for(var t=a.callbackList.splice(0,a.callbackList.length),n=t.length-1;n>=0;--n){var r=t[n];"error"==e.data?r.setError():r.setSuccess("unchanged"==e.data)}}}),!1),e.promise}function U(){a.enable&&i.token&&setTimeout((function(){C().then((function(e){e&&U()}))}),1e3*a.interval)}function C(){var e=_();if(a.iframe&&a.iframeOrigin){var t=i.clientId+" "+(i.sessionId?i.sessionId:"");a.callbackList.push(e);var n=a.iframeOrigin;1==a.callbackList.length&&a.iframe.contentWindow.postMessage(t,n)}else e.setSuccess();return e.promise}function A(){var e=_();if(a.enable||i.silentCheckSsoRedirectUri){var t=document.createElement("iframe");t.setAttribute("src",i.endpoints.thirdPartyCookiesIframe()),t.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),t.setAttribute("title","keycloak-3p-check-iframe"),t.style.display="none",document.body.appendChild(t);var r=function(n){t.contentWindow===n.source&&("supported"!==n.data&&"unsupported"!==n.data||("unsupported"===n.data&&(f("[KEYCLOAK] Your browser is blocking access to 3rd-party cookies, this means:\n\n - It is not possible to retrieve tokens without redirecting to the Keycloak server (a.k.a. no support for silent authentication).\n - It is not possible to automatically detect changes to the session status (such as the user logging out in another tab).\n\nFor more information see: https://www.keycloak.org/docs/latest/securing_apps/#_modern_browsers"),a.enable=!1,i.silentCheckSsoFallback&&(i.silentCheckSsoRedirectUri=!1)),document.body.removeChild(t),window.removeEventListener("message",r),e.setSuccess()))};window.addEventListener("message",r,!1)}else e.setSuccess();return function(e,t,r){var o=null,i=new n.Promise((function(e,n){o=setTimeout((function(){n({error:r})}),t)}));return n.Promise.race([e,i]).finally((function(){clearTimeout(o)}))}(e.promise,i.messageReceiveTimeout,"Timeout when waiting for 3rd party check iframe message.")}function T(e){if(!e||"default"==e)return{login:function(e){return window.location.assign(i.createLoginUrl(e)),_().promise},logout:async function(e){if("GET"===(e?.logoutMethod??i.logoutMethod))return void window.location.replace(i.createLogoutUrl(e));const t=i.createLogoutUrl(e),n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({id_token_hint:i.idToken,client_id:i.clientId,post_logout_redirect_uri:r.redirectUri(e,!1)})});if(n.redirected)window.location.href=n.url;else{if(!n.ok)throw new Error("Logout failed, request returned an error code.");window.location.reload()}},register:function(e){return window.location.assign(i.createRegisterUrl(e)),_().promise},accountManagement:function(){var e=i.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";return window.location.href=e,_().promise},redirectUri:function(e,t){return e&&e.redirectUri?e.redirectUri:i.redirectUri?i.redirectUri:location.href}};if("cordova"==e){a.enable=!1;var t=function(e,t,n){return window.cordova&&window.cordova.InAppBrowser?window.cordova.InAppBrowser.open(e,t,n):window.open(e,t,n)},n=function(e){var t=function(e){return e&&e.cordovaOptions?Object.keys(e.cordovaOptions).reduce((function(t,n){return t[n]=e.cordovaOptions[n],t}),{}):{}}(e);return t.location="no",e&&"none"==e.prompt&&(t.hidden="yes"),function(e){return Object.keys(e).reduce((function(t,n){return t.push(n+"="+e[n]),t}),[]).join(",")}(t)},o=function(){return i.redirectUri||"http://localhost"};return{login:function(e){var r=_(),s=n(e),a=i.createLoginUrl(e),c=t(a,"_blank",s),u=!1,l=!1,d=function(){l=!0,c.close()};return c.addEventListener("loadstart",(function(e){if(0==e.url.indexOf(o())){var t=i.parseCallback(e.url);i.processCallback(t,r),d(),u=!0}})),c.addEventListener("loaderror",(function(e){if(!u)if(0==e.url.indexOf(o())){var t=i.parseCallback(e.url);i.processCallback(t,r),d(),u=!0}else r.setError(),d()})),c.addEventListener("exit",(function(e){l||r.setError({reason:"closed_by_user"})})),r.promise},logout:function(e){var n,r=_(),s=i.createLogoutUrl(e),a=t(s,"_blank","location=no,hidden=yes,clearcache=yes");return a.addEventListener("loadstart",(function(e){0==e.url.indexOf(o())&&a.close()})),a.addEventListener("loaderror",(function(e){0==e.url.indexOf(o())||(n=!0),a.close()})),a.addEventListener("exit",(function(e){n?r.setError():(i.clearToken(),r.setSuccess())})),r.promise},register:function(e){var r=_(),s=i.createRegisterUrl(),a=n(e),c=t(s,"_blank",a);return c.addEventListener("loadstart",(function(e){if(0==e.url.indexOf(o())){c.close();var t=i.parseCallback(e.url);i.processCallback(t,r)}})),r.promise},accountManagement:function(){var e=i.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";var n=t(e,"_blank","location=no");n.addEventListener("loadstart",(function(e){0==e.url.indexOf(o())&&n.close()}))},redirectUri:function(e){return o()}}}if("cordova-native"==e)return a.enable=!1,{login:function(e){var t=_(),n=i.createLoginUrl(e);return universalLinks.subscribe("keycloak",(function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var n=i.parseCallback(e.url);i.processCallback(n,t)})),window.cordova.plugins.browsertab.openUrl(n),t.promise},logout:function(e){var t=_(),n=i.createLogoutUrl(e);return universalLinks.subscribe("keycloak",(function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close(),i.clearToken(),t.setSuccess()})),window.cordova.plugins.browsertab.openUrl(n),t.promise},register:function(e){var t=_(),n=i.createRegisterUrl(e);return universalLinks.subscribe("keycloak",(function(e){universalLinks.unsubscribe("keycloak"),window.cordova.plugins.browsertab.close();var n=i.parseCallback(e.url);i.processCallback(n,t)})),window.cordova.plugins.browsertab.openUrl(n),t.promise},accountManagement:function(){var e=i.createAccountUrl();if(void 0===e)throw"Not supported by the OIDC server";window.cordova.plugins.browsertab.openUrl(e)},redirectUri:function(e){return e&&e.redirectUri?e.redirectUri:i.redirectUri?i.redirectUri:"http://localhost"}};throw"invalid adapter type: "+e}i.init=function(e){if(i.didInitialize)throw new Error("A 'Keycloak' instance can only be initialized once.");i.didInitialize=!0,i.authenticated=!1,o=function(){try{return new E}catch(e){}return new I}();if(r=e&&["default","cordova","cordova-native"].indexOf(e.adapter)>-1?T(e.adapter):e&&"object"==typeof e.adapter?e.adapter:window.Cordova||window.cordova?T("cordova"):T(),e){if(void 0!==e.useNonce&&(l=e.useNonce),void 0!==e.checkLoginIframe&&(a.enable=e.checkLoginIframe),e.checkLoginIframeInterval&&(a.interval=e.checkLoginIframeInterval),"login-required"===e.onLoad&&(i.loginRequired=!0),e.responseMode){if("query"!==e.responseMode&&"fragment"!==e.responseMode)throw"Invalid value for responseMode";i.responseMode=e.responseMode}if(e.flow){switch(e.flow){case"standard":i.responseType="code";break;case"implicit":i.responseType="id_token token";break;case"hybrid":i.responseType="code id_token token";break;default:throw"Invalid value for flow"}i.flow=e.flow}if(null!=e.timeSkew&&(i.timeSkew=e.timeSkew),e.redirectUri&&(i.redirectUri=e.redirectUri),e.silentCheckSsoRedirectUri&&(i.silentCheckSsoRedirectUri=e.silentCheckSsoRedirectUri),"boolean"==typeof e.silentCheckSsoFallback?i.silentCheckSsoFallback=e.silentCheckSsoFallback:i.silentCheckSsoFallback=!0,void 0!==e.pkceMethod){if("S256"!==e.pkceMethod&&!1!==e.pkceMethod)throw new TypeError(`Invalid value for pkceMethod', expected 'S256' or false but got ${e.pkceMethod}.`);i.pkceMethod=e.pkceMethod}else i.pkceMethod="S256";"boolean"==typeof e.enableLogging?i.enableLogging=e.enableLogging:i.enableLogging=!1,"POST"===e.logoutMethod?i.logoutMethod="POST":i.logoutMethod="GET","string"==typeof e.scope&&(i.scope=e.scope),"string"==typeof e.acrValues&&(i.acrValues=e.acrValues),"number"==typeof e.messageReceiveTimeout&&e.messageReceiveTimeout>0?i.messageReceiveTimeout=e.messageReceiveTimeout:i.messageReceiveTimeout=1e4}i.responseMode||(i.responseMode="fragment"),i.responseType||(i.responseType="code",i.flow="standard");var n=_(),s=_();s.promise.then((function(){i.onReady&&i.onReady(i.authenticated),n.setSuccess(i.authenticated)})).catch((function(e){n.setError(e)}));var c=function(){var e,n=_();t?"string"==typeof t&&(e=t):e="keycloak.json";function r(e){i.endpoints=e?{authorize:function(){return e.authorization_endpoint},token:function(){return e.token_endpoint},logout:function(){if(!e.end_session_endpoint)throw"Not supported by the OIDC server";return e.end_session_endpoint},checkSessionIframe:function(){if(!e.check_session_iframe)throw"Not supported by the OIDC server";return e.check_session_iframe},register:function(){throw'Redirection to "Register user" page not supported in standard OIDC mode'},userinfo:function(){if(!e.userinfo_endpoint)throw"Not supported by the OIDC server";return e.userinfo_endpoint}}:{authorize:function(){return g()+"/protocol/openid-connect/auth"},token:function(){return g()+"/protocol/openid-connect/token"},logout:function(){return g()+"/protocol/openid-connect/logout"},checkSessionIframe:function(){var e=g()+"/protocol/openid-connect/login-status-iframe.html";return i.iframeVersion&&(e=e+"?version="+i.iframeVersion),e},thirdPartyCookiesIframe:function(){var e=g()+"/protocol/openid-connect/3p-cookies/step1.html";return i.iframeVersion&&(e=e+"?version="+i.iframeVersion),e},register:function(){return g()+"/protocol/openid-connect/registrations"},userinfo:function(){return g()+"/protocol/openid-connect/userinfo"}}}if(e){(a=new XMLHttpRequest).open("GET",e,!0),a.setRequestHeader("Accept","application/json"),a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status||v(a)){var e=JSON.parse(a.responseText);i.authServerUrl=e["auth-server-url"],i.realm=e.realm,i.clientId=e.resource,r(null),n.setSuccess()}else n.setError()},a.send()}else{if(!t.clientId)throw"clientId missing";i.clientId=t.clientId;var o=t.oidcProvider;if(o){var s,a;if("string"==typeof o)s="/"==o.charAt(o.length-1)?o+".well-known/openid-configuration":o+"/.well-known/openid-configuration",(a=new XMLHttpRequest).open("GET",s,!0),a.setRequestHeader("Accept","application/json"),a.onreadystatechange=function(){4==a.readyState&&(200==a.status||v(a)?(r(JSON.parse(a.responseText)),n.setSuccess()):n.setError())},a.send();else r(o),n.setSuccess()}else{if(!t.url)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++)if(c[u].src.match(/.*keycloak\.js/)){t.url=c[u].src.substr(0,c[u].src.indexOf("/js/keycloak.js"));break}if(!t.realm)throw"realm missing";i.authServerUrl=t.url,i.realm=t.realm,r(null),n.setSuccess()}}return n.promise}();function u(){var t=function(t){t||(r.prompt="none"),e&&e.locale&&(r.locale=e.locale),i.login(r).then((function(){s.setSuccess()})).catch((function(e){s.setError(e)}))},n=function(){var e=document.createElement("iframe"),t=i.createLoginUrl({prompt:"none",redirectUri:i.silentCheckSsoRedirectUri});e.setAttribute("src",t),e.setAttribute("sandbox","allow-storage-access-by-user-activation allow-scripts allow-same-origin"),e.setAttribute("title","keycloak-silent-check-sso"),e.style.display="none",document.body.appendChild(e);var n=function(t){if(t.origin===window.location.origin&&e.contentWindow===t.source){var r=i.parseCallback(t.data);i.processCallback(r,s),document.body.removeChild(e),window.removeEventListener("message",n)}};window.addEventListener("message",n)},r={};switch(e.onLoad){case"check-sso":a.enable?S().then((function(){C().then((function(e){e?s.setSuccess():i.silentCheckSsoRedirectUri?n():t(!1)})).catch((function(e){s.setError(e)}))})):i.silentCheckSsoRedirectUri?n():t(!1);break;case"login-required":t(!0);break;default:throw"Invalid value for onLoad"}}function d(){var t=i.parseCallback(window.location.href);if(t&&window.history.replaceState(window.history.state,null,t.newUrl),t&&t.valid)return S().then((function(){i.processCallback(t,s)})).catch((function(e){s.setError(e)}));e?e.token&&e.refreshToken?(w(e.token,e.refreshToken,e.idToken),a.enable?S().then((function(){C().then((function(e){e?(i.onAuthSuccess&&i.onAuthSuccess(),s.setSuccess(),U()):s.setSuccess()})).catch((function(e){s.setError(e)}))})):i.updateToken(-1).then((function(){i.onAuthSuccess&&i.onAuthSuccess(),s.setSuccess()})).catch((function(t){i.onAuthError&&i.onAuthError(),e.onLoad?u():s.setError(t)}))):e.onLoad?u():s.setSuccess():s.setSuccess()}return c.then((function(){(function(){var e=_(),t=function(){"interactive"!==document.readyState&&"complete"!==document.readyState||(document.removeEventListener("readystatechange",t),e.setSuccess())};return document.addEventListener("readystatechange",t),t(),e.promise})().then(A).then(d).catch((function(e){n.setError(e)}))})),c.catch((function(e){n.setError(e)})),n.promise},i.login=function(e){return r.login(e)},i.createLoginUrl=function(e){var t,n=b(),s=b(),a=r.redirectUri(e),c={state:n,nonce:s,redirectUri:encodeURIComponent(a),loginOptions:e};e&&e.prompt&&(c.prompt=e.prompt),t=e&&"register"==e.action?i.endpoints.register():i.endpoints.authorize();var u=e&&e.scope||i.scope;u?-1===u.indexOf("openid")&&(u="openid "+u):u="openid";var d,f,g=t+"?client_id="+encodeURIComponent(i.clientId)+"&redirect_uri="+encodeURIComponent(a)+"&state="+encodeURIComponent(n)+"&response_mode="+encodeURIComponent(i.responseMode)+"&response_type="+encodeURIComponent(i.responseType)+"&scope="+encodeURIComponent(u);if(l&&(g=g+"&nonce="+encodeURIComponent(s)),e&&e.prompt&&(g+="&prompt="+encodeURIComponent(e.prompt)),e&&e.maxAge&&(g+="&max_age="+encodeURIComponent(e.maxAge)),e&&e.loginHint&&(g+="&login_hint="+encodeURIComponent(e.loginHint)),e&&e.idpHint&&(g+="&kc_idp_hint="+encodeURIComponent(e.idpHint)),e&&e.action&&"register"!=e.action&&(g+="&kc_action="+encodeURIComponent(e.action)),e&&e.locale&&(g+="&ui_locales="+encodeURIComponent(e.locale)),e&&e.acr){var m=(d=e.acr,f={id_token:{acr:d}},JSON.stringify(f));g+="&claims="+encodeURIComponent(m)}if((e&&e.acrValues||i.acrValues)&&(g+="&acr_values="+encodeURIComponent(e.acrValues||i.acrValues)),i.pkceMethod){var v=p(96,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789");c.pkceCodeVerifier=v,g+="&code_challenge="+h(i.pkceMethod,v),g+="&code_challenge_method="+i.pkceMethod}return o.add(c),g},i.logout=function(e){return r.logout(e)},i.createLogoutUrl=function(e){if("POST"===(e?.logoutMethod??i.logoutMethod))return i.endpoints.logout();var t=i.endpoints.logout()+"?client_id="+encodeURIComponent(i.clientId)+"&post_logout_redirect_uri="+encodeURIComponent(r.redirectUri(e,!1));return i.idToken&&(t+="&id_token_hint="+encodeURIComponent(i.idToken)),t},i.register=function(e){return r.register(e)},i.createRegisterUrl=function(e){return e||(e={}),e.action="register",i.createLoginUrl(e)},i.createAccountUrl=function(e){var t=g(),n=void 0;return void 0!==t&&(n=t+"/account?referrer="+encodeURIComponent(i.clientId)+"&referrer_uri="+encodeURIComponent(r.redirectUri(e))),n},i.accountManagement=function(){return r.accountManagement()},i.hasRealmRole=function(e){var t=i.realmAccess;return!!t&&t.roles.indexOf(e)>=0},i.hasResourceRole=function(e,t){if(!i.resourceAccess)return!1;var n=i.resourceAccess[t||i.clientId];return!!n&&n.roles.indexOf(e)>=0},i.loadUserProfile=function(){var e=g()+"/account",t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+i.token);var n=_();return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(i.profile=JSON.parse(t.responseText),n.setSuccess(i.profile)):n.setError())},t.send(),n.promise},i.loadUserInfo=function(){var e=i.endpoints.userinfo(),t=new XMLHttpRequest;t.open("GET",e,!0),t.setRequestHeader("Accept","application/json"),t.setRequestHeader("Authorization","bearer "+i.token);var n=_();return t.onreadystatechange=function(){4==t.readyState&&(200==t.status?(i.userInfo=JSON.parse(t.responseText),n.setSuccess(i.userInfo)):n.setError())},t.send(),n.promise},i.isTokenExpired=function(e){if(!i.tokenParsed||!i.refreshToken&&"implicit"!=i.flow)throw"Not authenticated";if(null==i.timeSkew)return d("[KEYCLOAK] Unable to determine if token is expired as timeskew is not set"),!0;var t=i.tokenParsed.exp-Math.ceil((new Date).getTime()/1e3)+i.timeSkew;if(e){if(isNaN(e))throw"Invalid minValidity";t-=e}return t<0},i.updateToken=function(e){var t=_();if(!i.refreshToken)return t.setError(),t.promise;e=e||5;var n=function(){var n=!1;if(-1==e?(n=!0,d("[KEYCLOAK] Refreshing token: forced refresh")):i.tokenParsed&&!i.isTokenExpired(e)||(n=!0,d("[KEYCLOAK] Refreshing token: token expired")),n){var r="grant_type=refresh_token&refresh_token="+i.refreshToken,o=i.endpoints.token();if(s.push(t),1==s.length){var a=new XMLHttpRequest;a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.withCredentials=!0,r+="&client_id="+encodeURIComponent(i.clientId);var c=(new Date).getTime();a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){d("[KEYCLOAK] Token refreshed"),c=(c+(new Date).getTime())/2;var e=JSON.parse(a.responseText);w(e.access_token,e.refresh_token,e.id_token,c),i.onAuthRefreshSuccess&&i.onAuthRefreshSuccess();for(var t=s.pop();null!=t;t=s.pop())t.setSuccess(!0)}else{f("[KEYCLOAK] Failed to refresh token"),400==a.status&&i.clearToken(),i.onAuthRefreshError&&i.onAuthRefreshError();for(t=s.pop();null!=t;t=s.pop())t.setError(!0)}},a.send(r)}}else t.setSuccess(!1)};a.enable?C().then((function(){n()})).catch((function(e){t.setError(e)})):n();return t.promise},i.clearToken=function(){i.token&&(w(null,null,null),i.onAuthLogout&&i.onAuthLogout(),i.loginRequired&&i.login())},i.processCallback=function(e,t){var n=e.code,r=e.error,o=e.prompt,s=(new Date).getTime();if(e.kc_action_status&&i.onActionUpdate&&i.onActionUpdate(e.kc_action_status),r)if("none"!=o)if(e.error_description&&"authentication_expired"===e.error_description)i.login(e.loginOptions);else{var a={error:r,error_description:e.error_description};i.onAuthError&&i.onAuthError(a),t&&t.setError(a)}else t&&t.setSuccess();else if("standard"!=i.flow&&(e.access_token||e.id_token)&&p(e.access_token,null,e.id_token,!0),"implicit"!=i.flow&&n){var c="code="+n+"&grant_type=authorization_code",u=i.endpoints.token(),f=new XMLHttpRequest;f.open("POST",u,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c+="&client_id="+encodeURIComponent(i.clientId),c+="&redirect_uri="+e.redirectUri,e.pkceCodeVerifier&&(c+="&code_verifier="+e.pkceCodeVerifier),f.withCredentials=!0,f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status){var e=JSON.parse(f.responseText);p(e.access_token,e.refresh_token,e.id_token,"standard"===i.flow),U()}else i.onAuthError&&i.onAuthError(),t&&t.setError()},f.send(c)}function p(n,r,o,a){w(n,r,o,s=(s+(new Date).getTime())/2),l&&i.idTokenParsed&&i.idTokenParsed.nonce!=e.storedNonce?(d("[KEYCLOAK] Invalid nonce, clearing token"),i.clearToken(),t&&t.setError()):a&&(i.onAuthSuccess&&i.onAuthSuccess(),t&&t.setSuccess())}},i.parseCallback=function(e){var t=function(e){var t;switch(i.flow){case"standard":t=["code","state","session_state","kc_action_status","iss"];break;case"implicit":t=["access_token","token_type","id_token","state","session_state","expires_in","kc_action_status","iss"];break;case"hybrid":t=["access_token","token_type","id_token","code","state","session_state","expires_in","kc_action_status","iss"]}t.push("error"),t.push("error_description"),t.push("error_uri");var n,r,o=e.indexOf("?"),s=e.indexOf("#");"query"===i.responseMode&&-1!==o?(n=e.substring(0,o),""!==(r=y(e.substring(o+1,-1!==s?s:e.length),t)).paramsString&&(n+="?"+r.paramsString),-1!==s&&(n+=e.substring(s))):"fragment"===i.responseMode&&-1!==s&&(n=e.substring(0,s),""!==(r=y(e.substring(s+1),t)).paramsString&&(n+="#"+r.paramsString));if(r&&r.oauthParams)if("standard"===i.flow||"hybrid"===i.flow){if((r.oauthParams.code||r.oauthParams.error)&&r.oauthParams.state)return r.oauthParams.newUrl=n,r.oauthParams}else if("implicit"===i.flow&&(r.oauthParams.access_token||r.oauthParams.error)&&r.oauthParams.state)return r.oauthParams.newUrl=n,r.oauthParams}(e);if(t){var n=o.get(t.state);return n&&(t.valid=!0,t.redirectUri=n.redirectUri,t.storedNonce=n.nonce,t.prompt=n.prompt,t.pkceCodeVerifier=n.pkceCodeVerifier,t.loginOptions=n.loginOptions),t}},i.createPromise=_;var E=function(){if(!(this instanceof E))return new E;localStorage.setItem("kc-test","test"),localStorage.removeItem("kc-test");function e(){for(var e=(new Date).getTime(),t=0;t<localStorage.length;t++){var n=localStorage.key(t);if(n&&0==n.indexOf("kc-callback-")){var r=localStorage.getItem(n);if(r)try{var o=JSON.parse(r).expires;(!o||o<e)&&localStorage.removeItem(n)}catch(e){localStorage.removeItem(n)}}}}this.get=function(t){if(t){var n="kc-callback-"+t,r=localStorage.getItem(n);return r&&(localStorage.removeItem(n),r=JSON.parse(r)),e(),r}},this.add=function(t){e();var n="kc-callback-"+t.state;t.expires=(new Date).getTime()+36e5,localStorage.setItem(n,JSON.stringify(t))}},I=function(){if(!(this instanceof I))return new I;var e=this;e.get=function(e){if(e){var o=n("kc-callback-"+e);return r("kc-callback-"+e,"",t(-100)),o?JSON.parse(o):void 0}},e.add=function(e){r("kc-callback-"+e.state,JSON.stringify(e),t(60))},e.removeItem=function(e){r(e,"",t(-100))};var t=function(e){var t=new Date;return t.setTime(t.getTime()+60*e*1e3),t},n=function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""},r=function(e,t,n){var r=e+"="+t+"; expires="+n.toUTCString()+"; ";document.cookie=r}};function L(e){return function(){i.enableLogging&&e.apply(console,Array.prototype.slice.call(arguments))}}}}));
//# sourceMappingURL=keycloak.min.js.map
